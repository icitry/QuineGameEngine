let e="",t=1;const a=e=>{t=e};let s="#000000",n=0,o=()=>{},i=()=>{},r=()=>{},c=()=>{for(;v.length>0;){const e=v.shift();l(e.x,e.y,e.color)}};const l=(e,t,a)=>{const s=x.children[t]?.children[e];void 0!==s&&(s.style.color=a)};let y=()=>{};const d=()=>u,f=()=>M.t,h=()=>({o:M.o,i:M.i}),w=(e,t,a)=>{e+=Math.floor((n-M.o)/2)-1,v.push({x:e,y:t,color:a})},k=()=>{window.addEventListener("resize",(e=>{let t=x.offsetWidth;n=Math.floor(t/10.4),b(),y()})),b(),o(),g()};let x,u=0,p=0,v=[],M={t:60,l:16,o:0,i:0};const b=()=>{if(x=document.getElementById("game"),n=Math.floor(x.offsetWidth/10.4),e.length<1)return void(x.innerHTML="");const t='<div style="width:100%;display:flex;flex-wrap:nowrap;">'+e.split("").filter((e=>" "!==e)).map(((e,t)=>t%n==0?'</div><div style="width:100%;display:flex;flex-wrap:nowrap;">':`<div style="color: ${s}; font-size:13px; min-width: 0.8em; min-height: 0.8em;user-select:none;">${e}</div>`)).join("")+"</div>";x.innerHTML=t,x.style["font-size"]="13px",x.style["overflow-x"]="hidden",x.style["overflow-y"]="auto",x.removeChild(x.children[0])},g=async()=>{i();let e=0;for(t=1;t;){for(u++;u>p;)r(),p+=M.l;c(),e=p-u,e>=0&&await new Promise((t=>setTimeout(t,e)))}},m=()=>{e=`const r=${m};r();`;const n="#41454d",c={h:{k:{x:0,y:-1},key:"w"},u:{k:{x:0,y:1},key:"s"},p:{k:{x:-1,y:0},key:"a"},v:{k:{x:1,y:0},key:"d"},M:{k:{x:0,y:0},key:"q"}},l={m:0,S:1,P:2,T:3},x={O:0,C:1,N:2,G:3,H:4,J:5,W:6,$:7,I:8,L:9},u=new Map([[x.O,n],[x.C,"#e81515"],[x.N,"#e815a2"],[x.G,"#15bed1"],[x.H,"#d67f15"],[x.J,"#f0d807"],[x.W,"#290fd4"],[x.$,"#ffffff"],[x.I,"#0fd478"],[x.L,"#b30c28"]]);let p={j:{q:0,B:0,level:0,D:0,R:[],U:{},F:[],V:[],A:0},K:{X:3,Y:0,Z:{x:13,y:26},_:[{x:13,y:16},{x:13,y:17},{x:11,y:17},{x:15,y:17}],ee:[{x:25,y:0},{x:2,y:0},{x:27,y:34},{x:0,y:34}]}};const b=e=>Math.floor(Math.random()*e),g=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),S=(e,t)=>({x:Math.floor(e.x*t),y:Math.floor(e.y*t)}),P=(e,t)=>(e.x-t.x)**2+(e.y-t.y)**2,T=e=>S(e,-1),O=(e,t,a,s,n)=>({x:e.x<t?a:e.x>a?t:e.x,y:e.y<s?n:e.y>n?s:e.y}),C=e=>{let t=u.get(e.type);return void 0===t&&(t=n),!e.te&&[x.$,x.L,x.I].includes(e.type)&&(t=n),t},N=()=>{const e=h();for(let t=0;t<e.i;t++)for(let a=0;a<e.o;a++)w(a,t,C(p.j.F[t][a]))},E=(e,t,a=null)=>{p.j.R[e]={ae:{se:null!==a?a:p.K._[e],dir:c.p.k},type:e,ne:0,oe:p.K.ee[e],ie:t,re:-1,ce:-1,le:-1,ye:-1,de:0}},G=(e,t,a)=>{switch(p.j.F[a][t]={type:x.O,fe:x.O,te:1},e){case"#":p.j.F[a][t].type=x.W,p.j.F[a][t].fe=x.W;break;case".":p.j.F[a][t].type=x.$,p.j.F[a][t].fe=x.$,p.K.Y++;break;case"@":p.j.F[a][t].type=x.I,p.j.F[a][t].fe=x.I;break;case"o":if(p.j.B>=p.K.X)break;p.j.F[a][t].type=x.L,p.j.F[a][t].fe=x.L,p.j.V[p.j.B]={x:t,y:a},p.j.B++}},H=e=>{p.j.level=e,p.j.D=(e=>1+.1*e)(e),v=[],0==e?(()=>{const e=h();for(let t=0;t<e.i;t++){p.j.F[t]=[];for(let a=0;a<e.o;a++){let s=t*e.o+a;G("                                                                                    #############################............##............##.####.#####.##.#####.####.##@#  #.#   #.##.#   #.#  #@##.####.#####.##.#####.####.##..........................##.####.##.########.##.####.##.####.##.########.##.####.##......##....##....##......#######.##### ## #####.######     #.##### ## #####.#          #.##          ##.#          #.## ###  ### ##.#     ######.## #      # ##.######      .   #      #   .      ######.## #      # ##.######     #.## ######## ##.#          #.##          ##.#          #.## ######## ##.#     ######.## ######## ##.#######............##............##.####.#####.##.#####.####.##.####.#####.##.#####.####.##@..##.......  .......##..@####.##.##.########.##.##.######.##.##.########.##.##.####......##....##....##......##.##########.##.##########.##.##########.##.##########.##..........................############################# ooo                                                    "[s],a,t)}}})():(()=>{const e=h();for(let t=0;t<e.i;t++)for(let a=0;a<e.o;a++)p.j.F[t][a].type=p.j.F[t][a].fe,p.j.F[t][a].te=1})(),p.j.A=p.K.Y,E(l.m,p.j.q,{x:13,y:14}),E(l.S,p.j.q),E(l.P,p.j.q+Math.floor(30/p.j.D)),E(l.T,p.j.q+Math.floor(60/p.j.D)),p.j.U={ae:{se:p.K.Z,dir:c.M.k}}},J=e=>{p.j.q+=e,document.getElementById("score").innerHTML=`SCORE: ${p.j.q}`},W=e=>{e.ne=0,e.ae.dir=c.M.k,e.ae.se=p.K._[e.type],e.ce=d(),J(10)},$=e=>{let t=p.j.U.ae.se.x,a=p.j.U.ae.se.y;p.j.F[a][t].type=p.j.F[a][t].fe,w(t,a,C(p.j.F[a][t])),p.j.U.ae.se={x:e.x,y:e.y},t=e.x,a=e.y,p.j.F[a][t].type=x.J,w(t,a,C(p.j.F[a][t]))},z=()=>{if(0===p.j.B)return void a(0);p.j.B--;let e=p.j.V[p.j.B];p.j.F[e.y][e.x].te=0,w(e.x,e.y,C(p.j.F[e.y][e.x])),0!==p.j.B?$(p.K.Z):a(0)},I=(e,t,a)=>{const s=d(),n=f();t>0&&(2===e.ne&&s-e.ye>=t*n&&(e.ne=1,e.le=s),a>0&&1===e.ne&&s-e.le>=a*n&&(e.ne=2,e.ye=s,e.de++))},L=(e,t)=>{switch(p.j.F[t.y][t.x].type){case x.W:return 2;case x.J:return 3===e.ne?(W(e),-1):(z(),1)}return 0},j=e=>{const t=JSON.parse(JSON.stringify(e.ae.se));(e=>{if(e.ie>p.j.q)return;const t=JSON.parse(JSON.stringify(e.ne)),a=d(),s=f();if(0!==e.ne){if(3===e.ne){if(!(a-e.re>6*s))return;e.ye+=a-e.re,e.le+=a-e.re,e.ne=2}switch(e.de){case 0:case 1:I(e,Math.floor(7/p.j.D),20);break;case 2:I(e,Math.floor(5/p.j.D),20);break;case 3:I(e,Math.floor(5/p.j.D),-1)}t===e.ne||2!==t&&1!==t||(e.ae.dir=T(e.ae.dir))}else(-1===e.ce||a-e.ce>6*s)&&(e.ne=2,e.ye=a)})(e),(e=>{if(0===e.ne)return;(e=>{const t=p.j.U.ae,a=e.ae.se;var s,n;if(a.x>=11&&a.x<=16&&a.y>=16&&a.y<=18)e.oe={x:13,y:15};else switch(e.ne){case 2:e.oe=p.K.ee[e.type];break;case 1:switch(e.type){case l.m:e.oe=t.se;break;case l.S:e.oe=g(t.se,S(t.dir,4));break;case l.P:const a=p.j.R[l.m].ae.se,o=(n=a,{x:(s=g(t.se,S(t.dir,2))).x-n.x,y:s.y-n.y});e.oe=g(a,S(o,4));break;case l.T:P(e.ae.se,t.se)>64?e.oe=t.se:e.oe=p.K.ee[l.T]}case 3:e.oe=(()=>{const e=h();return{x:b(e.o),y:b(e.i)}})()}})(e);const t=h();let a=g(e.ae.se,S(e.ae.dir,p.j.D));a=O(a,0,t.o-1,0,t.i-1);const s=L(e,a);if(-1===s||2===s)return;e.ae.se={x:a.x,y:a.y};let n=1e5,o=0;const i=T(e.ae.dir);for(let[a,s]of Object.entries(c)){if("None"===a)continue;if((d=e.ae.se).x>=10&&d.x<=17&&(14===d.y||26===d.y)&&"Up"===a)continue;if(r=i,y=s.k,r.x===y.x&&r.y===y.y)continue;let c=g(e.ae.se,S(s.k,p.j.D));c=O(c,0,t.o-1,0,t.i-1);const l=L(e,c);-1!==l&&2!==l&&(o=P(c,e.oe),o<n&&(n=o,e.ae.dir=s.k))}var r,y,d})(e),((e,t)=>{const a=e.ae.se.x,s=e.ae.se.y;switch(p.j.F[t.y][t.x].type=p.j.F[t.y][t.x].fe,w(t.x,t.y,C(p.j.F[t.y][t.x])),e.type){case l.m:p.j.F[s][a].type=x.C;break;case l.S:p.j.F[s][a].type=x.N;break;case l.P:p.j.F[s][a].type=x.G;break;case l.T:p.j.F[s][a].type=x.H}w(a,s,C(p.j.F[s][a]))})(e,t)};var q,B;s=n,q={o:28,i:36},M={...M,...q},o=()=>{H(0)},i=()=>{N()},r=()=>{j(p.j.R[l.m]),j(p.j.R[l.S]),j(p.j.R[l.P]),j(p.j.R[l.T]),(()=>{let e=p.j.U.ae.se,t=p.j.U.ae.dir,a=g(e,t);const s=h();a=O(a,0,s.o-1,0,s.i-1);let n=(e=>{const t=new Map([[x.W,2],[x.$,1],[x.I,1],[x.C,-1],[x.N,-1],[x.G,-1],[x.H,-1]]);let a=p.j.F[e.y][e.x].type,s=t.get(a);return 1===s&&(p.j.F[e.y][e.x].te?p.j.F[e.y][e.x].te=0:s=0),a===x.I&&(()=>{for(const e in Object.keys(l))0!==p.j.R[e].ne&&(2!==p.j.R[e].ne&&1!==p.j.R[e].ne||(p.j.R[e].ae.dir=T(p.j.R[e].ae.dir)),p.j.R[e].ne=3,p.j.R[e].re=d())})(),a===x.C&&3===p.j.R[l.m].ne&&(W(p.j.R[l.m]),s=1),a===x.N&&3===p.j.R[l.S].ne&&(W(p.j.R[l.S]),s=1),a===x.G&&3===p.j.R[l.P].ne&&(W(p.j.R[l.P]),s=1),a===x.H&&3===p.j.R[l.T].ne&&(W(p.j.R[l.T]),s=1),s})(a);if(2!==n){if(1===n){if(J(1),p.j.A--,0==p.j.A)return H(p.j.level+1),void N()}else if(-1==n)return void z();$(a)}})()},y=()=>{N()},B=[{key:c.h.key,action:()=>{p.j.U.ae.dir=c.h.k}},{key:c.u.key,action:()=>{p.j.U.ae.dir=c.u.k}},{key:c.p.key,action:()=>{p.j.U.ae.dir=c.p.k}},{key:c.v.key,action:()=>{p.j.U.ae.dir=c.v.k}},{key:"q",action:()=>{a(0)}},{key:" ",action:()=>{t||k()}}],window.addEventListener("keypress",(e=>{e=e.key.toLocaleLowerCase(),B.forEach((t=>{t.key===e&&t.action()}))}),0),k()};m();